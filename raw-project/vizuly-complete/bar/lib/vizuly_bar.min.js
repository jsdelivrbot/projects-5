/*! vizuly 23-06-2016 */
vizuly.viz.bar=function(a){function b(){n=g.selection.append("svg").attr("id",g.id).style("overflow","visible").attr("class","vizuly"),t=n.append("rect").attr("class","vz-background"),v=vizuly.util.getDefs(i),w=v.append("clipPath").attr("id",g.id+"_plotClipPath").append("rect"),x=v.append("clipPath").attr("id",g.id+"_xClipPath").append("rect"),o=n.append("g").attr("class","vz-bar-viz"),p=o.append("g").attr("class","vz-bottom-axis"),q=o.append("g").attr("class","vz-left-axis").attr("clip-path","url(#"+g.id+"_yClipPath)").append("g"),r=o.append("g").attr("class","vz-plot").attr("clip-path","url(#"+g.id+"_plotClipPath)"),u=r.append("rect").attr("class","vz-plot-background").style("fill","#0f2747").style("fill-opacity",.01),g.dispatch.initialize()}function c(){i.validate(),j=vizuly.util.size(g.margin,g.width,g.height),l=j.height/g.data[0].length*(1-g.padding),k=l/g.data.length*(1-g.padding),g.layout==vizuly.viz.layout.STACKED&&(m=d3.layout.stack().values(function(a){return a}).x(function(a){return g.y(a)}).y(function(a){return g.x(a)}).out(function(a,b,c){a.x0=b}).order("reverse"))(g.data),g.xScale.domain([0,d3.max(g.data,function(a){return d3.max(a,function(a){return g.x(a)+(g.layout==vizuly.viz.layout.STACKED?a.x0:0)})})]),"string"==typeof g.y(g.data[0][0])?g.yScale.domain(g.data[0].map(function(a){return g.y(a)})):g.yScale.domain([d3.min(g.data[0],function(a){return g.y(a)}),d3.max(g.data[0],function(a){return g.y(a)})]),vizuly.util.setRange(g.yScale,0,j.height),vizuly.util.setRange(g.xScale,0,j.width),g.xAxis.scale(g.xScale).orient("bottom"),g.yAxis.scale(g.yScale).orient("left"),e(),g.dispatch.measure()}function d(){c(),n.attr("width",g.width).attr("height",g.height),t.attr("width",g.width).attr("height",g.height),w.attr("width",j.width).attr("height",j.height),x.attr("width",j.width).attr("height",g.height-j.height).attr("transform","translate("+(j.left+k*g.padding)+","+j.height+")"),r.style("width",j.width).style("height",j.height).attr("transform","translate("+(j.left+k)+","+j.top+")"),p.attr("transform","translate("+(j.left+k)+","+(j.height+j.top)+")"),q.attr("transform","translate("+(j.left+k-k*g.padding)+","+j.top+")"),u.attr("width",j.width).attr("height",j.height),s=r.selectAll(".vz-bar-group").data(g.data[0]),s.enter().append("g").attr("class","vz-bar-group"),s.exit().remove(),s.each(function(a,b){var c=d3.select(this).selectAll(".vz-bar").data(g.data.map(function(a){return a[b]}));c.enter().append("rect").attr("class","vizuly vz-bar").attr("y",function(a,b){return b*(k+k*g.padding)}).attr("width",0).attr("x",0).on("mouseover",function(a,b){g.dispatch.mouseover(this,a,b)}).on("mouseout",function(a,b){g.dispatch.mouseout(this,a,b)}).on("click",function(a,b){g.dispatch.click(this,a,b)}).on("touch",function(a,b){g.dispatch.touch(this,a,b)}),c.exit().remove(),g.layout==vizuly.viz.layout.STACKED?c.transition().duration(g.duration).attr("y",0).attr("height",l).attr("width",function(a,b){return g.xScale(g.x(a))}).attr("x",function(a,b){return g.xScale(a.x0)}):c.transition().duration(g.duration).attr("y",function(a,b){return b*(k+k*g.padding)}).attr("height",k).attr("width",function(a,b){return g.xScale(g.x(a))}).attr("x",0)}),s.attr("transform",function(a,b){return"translate(0,"+g.yScale(g.y(a))+")"}),p.call(g.xAxis),q.call(g.yAxis),g.dispatch.update()}function e(){g.zoom||(g.zoom=d3.behavior.zoom().scaleExtent([1,10]).on("zoomstart",function(){w.attr("width",j.width),x.attr("width",j.left).attr("height",j.height).attr("transform","translate(0,"+j.top+")"),g.dispatch.zoomstart()}).on("zoom",f),r.call(g.zoom)),g.zoom.scale(1).translate([0,0]),w.attr("width",j.width).attr("height",j.height),x.attr("width",j.left).attr("height",j.height).attr("transform","translate(0,"+(j.top+k*g.padding)+")")}function f(){var a=d3.event?d3.event.translate[1]:g.zoom.translate()[1];a<-(g.zoom.scale()*j.height)+j.height?a=-(g.zoom.scale()*j.height)+j.height:a>0&&(a=0),vizuly.util.setRange(g.yScale,0,Math.round(j.height*g.zoom.scale())),s.attr("transform",function(b,c){return"translate(0,"+(a+g.yScale(g.y(b)))+")"}).selectAll(".vz-bar").attr("y",function(a,b){return g.layout==vizuly.viz.layout.STACKED?0:b*(k*g.zoom.scale()+k*g.zoom.scale()*g.padding)}).attr("height",function(a,b){return g.layout==vizuly.viz.layout.STACKED?l*g.zoom.scale():k*g.zoom.scale()}),q.attr("transform","translate("+j.left+","+(j.top+k*g.padding+a)+")"),q.call(g.yAxis),g.dispatch.zoom()}var g={},h={data:null,layout:vizuly.viz.layout.CLUSTERED,margin:{top:"10%",bottom:"7%",left:"9%",right:"7%"},duration:500,width:300,height:300,padding:.1,x:null,y:null,xScale:d3.scale.linear(),yScale:d3.scale.ordinal(),xAxis:d3.svg.axis(),yAxis:d3.svg.axis()},i=vizuly.component.create(a,g,h);i.type="viz.chart.bar";var j,k,l,m,n,o,p,q,r,s,t,u,v;b(),i.update=function(){return d(),i},g.zoom=null,i.zoom=function(a){return arguments.length?(g.zoom=a,void f()):g.zoom};var w,x;return i};